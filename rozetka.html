<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ROZETCA</title>
  <style>
    /* Сброс и базовая вёрстка */
    html,body{
      height:100%;
      margin:0;
      background:#000;
      font-family: Inter, Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Контейнер под видео */
    .video-wrap{
      position:fixed;
      inset:0; /* full screen */
      overflow:hidden;
      z-index:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#000;
    }

    /* Видео растянуто с сохранением пропорций, обрезается (cover) */
    video#bgVideo{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      width:100%;
      height:100%;
      object-fit:cover; /* fill whole area, обрезая при необходимости */
      -webkit-user-select:none;
      user-select:none;
      outline:none;
    }

    /* Плавающая панель с большим регулятором громкости */
    .controls{
      position:fixed;
      bottom:40px;
      left:50%;
      transform:translateX(-50%);
      z-index:10;
      display:flex;
      gap:16px;
      align-items:center;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
      padding:14px 18px;
      border-radius:14px;
      box-shadow: 0 6px 30px rgba(0,0,0,0.5);
      color: #fff;
      min-width:320px;
      max-width:90%;
    }

    .label{
      font-size:15px;
      letter-spacing:0.2px;
      opacity:0.95;
      white-space:nowrap;
    }

    /* Большой ползунок (input[type=range]) */
    input[type="range"].big {
      -webkit-appearance: none;
      appearance: none;
      width: 320px;
      height: 18px;
      background: transparent;
      cursor: pointer;
    }

    /* трек */
    input[type="range"].big::-webkit-slider-runnable-track{
      height: 8px;
      background: rgba(255,255,255,0.25);
      border-radius: 999px;
    }
    input[type="range"].big::-moz-range-track{
      height: 8px;
      background: rgba(255,255,255,0.25);
      border-radius: 999px;
    }

    /* заполненная часть трека (через background в JS) — ползунок ниже стилизует сам круг */
    input[type="range"].big::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:28px;
      height:28px;
      border-radius:50%;
      border: 3px solid rgba(255,255,255,0.95);
      background: rgba(0,0,0,0.45);
      margin-top: -10px; /* центрирование относительно трека */
      box-shadow: 0 4px 12px rgba(0,0,0,0.45);
    }
    input[type="range"].big::-moz-range-thumb{
      width:28px;
      height:28px;
      border-radius:50%;
      border: 3px solid rgba(255,255,255,0.95);
      background: rgba(0,0,0,0.45);
      box-shadow: 0 4px 12px rgba(0,0,0,0.45);
    }

    /* Кнопка-звук (иконка) */
    .mute-btn{
      display:inline-grid;
      place-items:center;
      width:44px;
      height:44px;
      border-radius:10px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.06);
    }
    .mute-btn svg{ width:20px; height:20px; fill:none; stroke: #fff; stroke-width:1.6; opacity:0.95; }

    /* Адаптив */
    @media (max-width:420px){
      .controls{ padding:10px; gap:10px; bottom:20px; }
      input[type="range"].big{ width:180px; height:14px; }
    }
  </style>
</head>
<body>

  <div class="video-wrap" aria-hidden="true">
    <!-- Положи сюда video.mp4 (или укажи путь) -->
    <video id="bgVideo" src="rozetka.mp4"
           autoplay
           loop
           playsinline
           muted
           preload="auto"
           tabindex="-1"
           aria-hidden="true"></video>
  </div>

  <!-- Панель с регулятором громкости -->
  <div class="controls" role="region" aria-label="Регулятор громкости">
    <div class="mute-btn" id="muteBtn" title="Включить/выключить звук" role="button" aria-pressed="false" tabindex="0">
      <!-- простая иконка динамика (изменится при mute/unmute через JS) -->
      <svg viewBox="0 0 24 24" id="speakerIcon" aria-hidden="true">
        <path d="M3 10v4h4l5 5V5L7 10H3z"></path>
      </svg>
    </div>

    <div class="label" id="volLabel">Громкость</div>

    <input
      id="volumeSlider"
      class="big"
      type="range"
      min="0"
      max="100"
      step="1"
      value="0"
      aria-label="Регулятор громкости"
    />
  </div>

  <script>
    (function(){
      const video = document.getElementById('bgVideo');
      const slider = document.getElementById('volumeSlider');
      const muteBtn = document.getElementById('muteBtn');
      const volLabel = document.getElementById('volLabel');
      const speakerIcon = document.getElementById('speakerIcon');

      // Установка начального состояния: видео запущено, но muted=true (из-за политик браузера)
      // Если браузер разрешит autoplay с звуком — это сработает. Иначе пользователь управляет громкостью.
      slider.value = 0; // старт — без звука
      updateSliderBackground();

      // Функция для установки громкости от 0..1
      function setVolumeFromValue(v){
        const vol = Math.max(0, Math.min(1, v/100));
        video.volume = vol;
        // Если звук включён (>0) — снимаем muted
        if(vol > 0){
          video.muted = false;
          muteBtn.setAttribute('aria-pressed','false');
        } else {
          video.muted = true;
          muteBtn.setAttribute('aria-pressed','true');
        }
        volLabel.textContent = vol > 0 ? `Громкость ${Math.round(vol*100)}%` : 'Выключено';
        updateSpeakerIcon(vol);
        updateSliderBackground();
      }

      // Отрисовка заполненной части трека (visual)
      function updateSliderBackground(){
        const val = Number(slider.value);
        const percent = val;
        slider.style.background = `linear-gradient(90deg, rgba(255,255,255,0.85) ${percent}%, rgba(255,255,255,0.12) ${percent}%)`;
      }

      // Обновление иконки динамика
      function updateSpeakerIcon(vol){
        // Изменяем простую svg — если 0, то перечёркнутый
        if(vol === 0){
          speakerIcon.innerHTML = '<path d="M3 10v4h4l5 5V5L7 10H3z"></path><path d="M16 8l5 8"></path>';
          muteBtn.setAttribute('title','Включить звук');
        } else if (vol <= 0.4) {
          speakerIcon.innerHTML = '<path d="M3 10v4h4l5 5V5L7 10H3z"></path><path d="M16 9c1 1 1 3 0 4"></path>';
          muteBtn.setAttribute('title','Выключить звук');
        } else {
          speakerIcon.innerHTML = '<path d="M3 10v4h4l5 5V5L7 10H3z"></path><path d="M16 7c2.5 2.5 2.5 7.5 0 10"></path>';
          muteBtn.setAttribute('title','Выключить звук');
        }
      }

      // Слушаем изменения слайдера
      slider.addEventListener('input', (e) => {
        setVolumeFromValue(Number(e.target.value));
      });

      // Клик по кнопке — вкл/выкл звук (toggle)
      muteBtn.addEventListener('click', () => {
        if(video.muted || video.volume === 0){
          // включаем на 70% стандартно
          slider.value = 70;
          setVolumeFromValue(70);
        } else {
          slider.value = 0;
          setVolumeFromValue(0);
        }
      });

      // Доступность: реагируем на Enter/Space
      muteBtn.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          muteBtn.click();
        }
      });

      // Горячие клавиши: стрелки вверх/вниз — регулировка громкости, M — mute
      window.addEventListener('keydown', (e) => {
        // не перехватываем если фокус в input
        if(document.activeElement && document.activeElement.tagName === 'INPUT') return;

        if(e.key === 'ArrowUp'){
          e.preventDefault();
          let v = Math.min(100, Number(slider.value) + 5);
          slider.value = v;
          setVolumeFromValue(v);
        } else if(e.key === 'ArrowDown'){
          e.preventDefault();
          let v = Math.max(0, Number(slider.value) - 5);
          slider.value = v;
          setVolumeFromValue(v);
        } else if(e.key.toLowerCase() === 'm'){
          e.preventDefault();
          muteBtn.click();
        }
      });

      // Пытаемся автоматически проиграть видео (иногда браузеры блокируют звук).
      // Если autoplay с немью не сработал, пользователю достаточно коснуться слайдер — это снимет ограничения.
      function tryPlay(){
        video.play().catch(()=> {
          // play blocked — оставляем его в автозапуске muted (из атрибута muted).
          // Пользователь действиями (нажатие ползунка) разрешит звук.
        });
      }

      // Запуск
      tryPlay();

      // При первом взаимодействии с документом — если volume>0, снимем muted и выставим громкость
      function firstInteractionHandler(){
        if(!video) return;
        if(Number(slider.value) > 0){
          video.muted = false;
          video.volume = Number(slider.value)/100;
        }
        // убираем обработчик после первого взаимодействия
        window.removeEventListener('click', firstInteractionHandler);
        window.removeEventListener('touchstart', firstInteractionHandler);
        window.removeEventListener('keydown', firstInteractionHandler);
      }
      window.addEventListener('click', firstInteractionHandler, { once: true });
      window.addEventListener('touchstart', firstInteractionHandler, { once: true });
      window.addEventListener('keydown', firstInteractionHandler, { once: true });

      // Если видео источника нет или не доступно — покажем подсказку
      video.addEventListener('error', () => {
        volLabel.textContent = 'Ошибка загрузки video.mp4 — поместите файл рядом с этой страницей';
      });

      // Инициализируем иконку
      updateSpeakerIcon(0);

    })();
  </script>
</body>
</html>
